import requests
from fake_useragent import UserAgent
import random

api_url = "https://www.carwale.com/api/v4/autocomplete/?source=1%2C2%2C3%2C5%2C11%2C15%2C13%2C14%2C10%2C16%2C17%2C4%2C8%2C9%2C6%2C19%2C20%2C21%2C22%2C23%2C24%2C25%2C26%2C27%2C28%2C29&value=mahindra&size=20&applicationId=1&showNoResult=true&cityId=-1"

ua = UserAgent()

proxies = [
    "159.69.57.20:8880",
    "216.229.112.25:8080",
    "57.128.37.47:3128",
    "54.207.65.150:3128",
    "203.154.91.225:4857",
    "119.156.195.173:3128",
    "52.194.186.70:1080",
    "155.94.128.59:10809",
    "45.140.143.77:18080",
    "3.110.60.103:80",
    "89.187.185.88:3128",
    "13.59.242.56:50000",
    "34.143.143.61:7777",
    "47.251.122.81:8888",
    "66.201.7.151:3128",
    "172.188.122.92:80",
    "104.223.103.219:3428",
    "18.181.122.43:80",
    "95.164.7.203:1080",
    "8.219.97.248:80",
    "203.77.215.45:10000",
    "66.151.41.206:4857",
    "114.80.40.128:3081",
    "106.251.66.243:64611",
    "47.252.29.28:11222",
    "106.117.208.101:7890",
    "111.67.193.111:7890",
    "110.83.12.128:8118",
    "34.204.121.255:80",
    "38.242.135.162:4857",
    "43.156.38.109:988",
    "172.167.161.8:8080",
    "113.186.196.69:8080",
    "52.87.51.110:80",
    "67.43.228.251:21621",
    "65.108.159.129:8081",
    "45.76.251.79:3128",
    "67.43.228.250:7015",
    "170.106.144.64:8090",
    "103.117.57.200:80",
    "72.10.160.90:18457",
    "20.27.15.49:8561",
    "47.89.184.18:3128",
    "72.10.160.92:10347",
    "148.206.32.3:8080",
    "45.170.226.250:999",
    "47.91.65.23:3128",
    "8.209.255.13:3128",
    "8.213.151.128:3128",
    "72.10.160.170:3897",
    "20.210.39.153:8561",
    "20.78.118.91:8561",
    "20.78.26.206:8561",
    "45.32.211.127:3128",
    "72.10.160.93:23969",
    "46.101.104.251:34117",
    "14.224.174.168:3998",
    "44.220.205.79:8080",
    "14.39.239.79:50870",
    "160.191.237.200:1219",
    "16.78.221.235:8080",
    "72.10.160.94:31239",
    "72.10.160.173:11025",
    "38.188.178.6:999",
    "115.77.172.246:10001",
    "111.72.197.193:2324",
    "14.103.249.81:3128",
    "110.188.37.169:2324",
    "96.30.195.4:3128",
    "13.217.237.57:80",
    "72.10.160.174:4129",
    "115.72.163.146:10002",
    "107.175.87.138:8080",
    "65.2.44.94:80",
    "45.32.216.124:3128",
    "45.32.217.86:3128",
    "51.112.90.124:8118",
    "195.26.245.238:4857",
    "72.10.160.171:16413",
    "67.43.228.252:20093",
    "182.253.42.148:8082",
    "47.91.104.88:3128",
    "139.0.27.91:80",
    "23.95.254.34:8080",
    "3.212.148.199:3128",
    "44.219.175.186:80",
    "52.73.224.54:3128",
    "3.90.100.12:80",
    "13.214.14.133:8080",
    "44.195.247.145:80",
    "44.218.183.55:80",
    "67.43.236.21:2315",
    "91.72.220.106:8181",
    "43.153.42.147:8088",
    "45.76.250.208:3128",
    "155.138.237.158:3128",
    "118.113.247.148:2324",
    "165.227.150.53:3128",
    "3.96.92.88:3128",
    "3.97.176.251:3128"
]

for ip in proxies:
    proxies_list =[{"http":f"http://{ip}",
                    "https":f"http://{ip}"}]

    random.shuffle(proxies_list)

    for proxy in proxies_list:
        header = {"User-Agent":ua.random}
        print(f"\n Trying proxies : {proxy["http"]}")
        try:
            response = requests.get(api_url,headers=header,proxies=proxy,timeout=10)
            response.raise_for_status()

            data = response.json()

            filter_data = []
            for item in data:
                items = {
                    "modelName": item["payload"].get("modelName"),
                    "makeName" : item["payload"].get("makeName")
                }
                filter_data.append(items)

            for modelname in filter_data:
                print(modelname)
            print("\n Data fetched successfully")
            break
        except:
            print("proxy failed")